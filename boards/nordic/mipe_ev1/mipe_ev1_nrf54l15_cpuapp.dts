/*
 * Copyright (c) 2025 MIPE_EV1 Project
 * SPDX-License-Identifier: Apache-2.0
 */

/dts-v1/;

#include <nordic/nrf54l15_cpuapp.dtsi>

/ {
	model = "MIPE_EV1 Custom Board";
	compatible = "mipe,mipe-ev1";

	chosen {
		zephyr,sram = &cpuapp_sram;
		zephyr,flash = &cpuapp_rram;
		zephyr,code-partition = &slot0_partition;
	};

	leds {
		compatible = "gpio-leds";
		led0: led_0 {
			gpios = <&gpio0 0 GPIO_ACTIVE_HIGH>;
			label = "LED 0";
		};
		led1: led_1 {
			gpios = <&gpio0 1 GPIO_ACTIVE_HIGH>;
			label = "LED 1";
		};
	};

	test_pins {
		compatible = "gpio-leds";
		testpin05: test_pin_05 {
			gpios = <&gpio1 5 GPIO_ACTIVE_HIGH>;
			label = "Test Pin 05";
		};
		testpin06: test_pin_06 {
			gpios = <&gpio1 6 GPIO_ACTIVE_HIGH>;
		};
	};

	/* SPI pinctrl configuration for LSM6DSO32 */
	pinctrl {
		compatible = "nordic,nrf-pinctrl";

		spi00_default: spi00_default {
			group1 {
				psels = <NRF_PSEL(SPIM_SCK, 0, 8)>,
				        <NRF_PSEL(SPIM_MOSI, 0, 9)>,
				        <NRF_PSEL(SPIM_MISO, 0, 11)>;
			};
		};
	};

	aliases {
		led0 = &led0;
		led1 = &led1;
		testpin05 = &testpin05;
		testpin06 = &testpin06;
	};
};

/* Enable GPIO ports */
&gpio0 {
	status = "okay";
};

&gpio1 {
	status = "okay";
};

/* Enable GPIOTE instances - REQUIRED for GPIO operations */
&gpiote20 {
	status = "okay";
};

&gpiote30 {
	status = "okay";
};

/* Enable SPI for LSM6DSO32 sensor communication */
&spi00 {
	status = "okay";
	cs-gpios = <&gpio0 10 GPIO_ACTIVE_LOW>;
	pinctrl-0 = <&spi00_default>;
	pinctrl-names = "default";

	lsm6dso32: lsm6dso32@0 {
		compatible = "st,lsm6dso32";
		reg = <0>;
		spi-max-frequency = <1000000>; /* 1MHz for stable communication */
		label = "LSM6DSO32";
	};
};

/* Re-enable GRTC timer - minimal required configuration */
&grtc {
	owned-channels = <0>;
	status = "okay";
};

/* Include partition configuration */
#include <nordic/nrf54l15_partition.dtsi>
